pipeline {
  agent any

  environment {
    IMAGE_NAME = "your-registry-or-local/simple-node-static"
    IMAGE_TAG  = "latest"
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Build Docker image') {
      steps {
        script {
          sh "docker build -t ${IMAGE_NAME}:${IMAGE_TAG} ."
        }
      }
    }

    stage('Run tests (optional)') {
      steps {
        echo "No tests defined. Add your test step here."
        // Example:
        // sh "npm test"
      }
    }

    stage('Push image (optional)') {
      when {
        expression { return false } // change to true if you want to push
      }
      steps {
        // Example for pushing to registry â€” configure credentials in Jenkins
        // sh "echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin registry.example.com"
        // sh "docker push ${IMAGE_NAME}:${IMAGE_TAG}"
        echo "Push step is disabled by default. Enable and configure credentials to push."
      }
    }

    stage('Deploy with docker-compose (optional)') {
      steps {
        echo "Bringing up containers with docker-compose (if desired)."
        // If using docker-compose on agent:
        // sh "docker-compose down || true"
        // sh "docker-compose up -d"
      }
    }
  }

  post {
    always {
      echo 'Pipeline finished.'
    }
    success {
      echo "Build succeeded: ${IMAGE_NAME}:${IMAGE_TAG}"
    }
    failure {
      echo "Build failed."
    }
  }
}
